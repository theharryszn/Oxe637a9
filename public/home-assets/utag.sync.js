//version: 20221022141450968
var TNL=function(){var whitelist=[],exclude=[],globalHashes={},utag_data=window.utag_data||{app_id:window._wfPayload?.myContext?.appContext?.currentApp?.toLowerCase(),page_id:window._wfPayload?.myContext?.thirdParty?.utag?.page_id?.toLowerCase(),page_type:window._wfPayload?.myContext?.deviceContext?.deviceExp?.toLowerCase(),mt_tag_path:window._wfPayload?.myContext?.urls?.mtTagPath,mpuid:window._wfPayload?.myContext?.thirdParty?.utag?.wfaCookie,page_type:window._wfPayload?.myContext?.deviceContext?.deviceExp?.toLowerCase(),device_type:window._wfPayload?.myContext?.deviceContext?.deviceType.toLowerCase(),environment:window._wfPayload?.myContext?.thirdParty?.utag?.environment?.toLowerCase(),lang_pref:window._wfPayload?.customerContext?.custPreferedLang?.toLowerCase()==="english"?"en":"sp",hashedecn:window._wfPayload?.myContext?.thirdParty?.utag?.hashedecn},mmapiVersion="2.3-EA",mmpackageVersion="1.27",encType="SHA-256",globalPackages=["mmpackage-"+mmpackageVersion+".js","//service.maxymiser.net/platform/us/api/utils/uh.js"],environment=utag_data?.environment?.toLowerCase(),isDev=environment!=="production"&&environment!=="prod"&&environment!=="staging",isExcluded=false,isWhitelised=false,validUDO=utag_data&&utag_data?.app_id&&utag_data?.device_type&&utag_data?.environment&&utag_data?.page_type&&utag_data?.mt_tag_path,hasGeneralNelson=navigator.userAgent.match(/GeneralNelson/i),nonce="",rttoExperience="",campaignResponse=[],mtTagPath=utag_data?.mt_tag_path+"tnl/m2/",enabled=true,validResponse=true,params={error:"",message:"|uri="+window.location.pathname+"|environment="+utag_data?.environment?.toLowerCase()+"|platform="+utag_data?.app_id?.toLowerCase()+"|device="+utag_data?.device_type?.toLowerCase()+"|wfacookie="+utag_data?.mpuid},sendErrorPixel=function(params){var reqParams=encodeURIComponent("error="+params.error+params.message);var pixelUrl=mtTagPath+"mt.gif?"+reqParams;var elem=new Image(0,0);elem.src=pixelUrl},logger=function(message,params){if(isDev){console.log(message)}else if(!isDev&&params){sendErrorPixel(params);TNL.validResponse?TNL.validResponse=false:""}},setRttoExperience=function(){for(var i=0;i<campaignResponse.length;i++){for(var j=0;j<campaignResponse[i].Elements.length;j++){if(rttoExperience){rttoExperience+="|campaign:"+campaignResponse[i].Name+"|element:"+campaignResponse[i].Elements[j].Name+"|variant:"+campaignResponse[i].Elements[j].VariantName}else{rttoExperience="campaign:"+campaignResponse[i].Name+"|element:"+campaignResponse[i].Elements[j].Name+"|variant:"+campaignResponse[i].Elements[j].VariantName}}}utag_data.rtto_exp=rttoExperience},setNonceAttribute=function(){var scripts=document.querySelectorAll("script");for(var i=0;i<scripts.length;i++){if(scripts[i].nonce){TNL.nonce=scripts[i].nonce;break}}},udoMatch=function(whitelist,option){var udoKeys=Object.keys(whitelist.udo);for(var i=0;i<udoKeys.length;i++){if(utag_data[udoKeys[i]]?.toLowerCase()!==whitelist.udo[udoKeys[i]]?.toLowerCase()){return false}}return true},uriMatch=function(whitelist,option){if(whitelist.uri){if(whitelist.subdirectory){whitelist.uri+=window.location.pathname.replace(whitelist.uri,"")}var uri=new RegExp(whitelist.uri+"(/|)(?:(home|index|)(/|.jhtml|.html|.htm|)?)$","i");return uri.test(window.location.pathname)===true}return true},invokeTestAndLearn=function(){var script=document.createElement("script");script.type="text/javascript";script.src=mtTagPath+"mmapi-"+mmapiVersion+".js";script.async=true;script.setAttribute("nonce",TNL.nonce);document.head.appendChild(script)},validateWhitelist=function(whitelist,option){if(option==="include"){isWhitelised=true;invokeTestAndLearn()}else{isExcluded=true}},hasCampaign=function(whitelist,option){for(var i=0;i<whitelist.length;i++){if(whitelist[i].udo&&uriMatch(whitelist[i],option)&&udoMatch(whitelist[i],option)){validateWhitelist(whitelist[i],option);break}}},replacer=function(name,val){if(val&&typeof val==="function"){val=val.toString();return val.replace(/function\s\(site/,"function(site")}else{return val}},cryptoSubtle=function(){var promises=[],localHashes={};for(let i=0;i<campaignResponse.length;i++){if(campaignResponse[i].Elements.length){var msgUint8=(new TextEncoder).encode(JSON.stringify(campaignResponse[i],replacer));promises.push(crypto.subtle.digest(encType,msgUint8).then((function(hashBuffer){var hashArray=Array.from(new Uint8Array(hashBuffer)),hashHex=hashArray.map((function(b){return b.toString(16).padStart(2,"0")})).join("");localHashes[hashHex]=campaignResponse[i].Name})))}}return Promise.all(promises).then((function(){Object.keys(localHashes).forEach((function(key){if(!(key in globalHashes)){params.error="HASH DOES NOT MATCH: "+localHashes[key];logger("RTTO: HASH DOES NOT MATCH: "+localHashes[key]+": "+key,params)}}))}))},packageHandler=function(response){campaignResponse=response.Campaigns||[];var helperPackages=response.Packages||[];switch(true){case"undefined"===typeof response:params.error="response is undefined";logger("RTTO: Response is not defined",params);break;case campaignResponse.length===0:logger("RTTO: There is no campaign data "+response);break;case campaignResponse.length>0:setRttoExperience();helperPackages.forEach((function(key){if(globalPackages.indexOf(key)===-1){params.error="globalPackage does not match";logger(key+" globalPackage DOES NOT MATCH",params)}}));for(var i=0;i<campaignResponse.length;i++){var obj=campaignResponse[i];if(obj.HighLevelApiVersion!==mmpackageVersion){params.error="apiVersion does not match";logger("RTTO: "+obj.HighLevelApiVersion+" ApiVersion DOES NOT MATCH",params)}delete obj.HighLevelApiVersion;for(var k=0;k<obj.Scripts.length;k++){delete obj.Scripts[k].HighLevelApiVersion}logger("RTTO: CAMPAIGN: "+obj.Name);if(obj.Elements.length){for(var j=0;j<obj.Elements.length;j++){logger("RTTO: ELEMENT: "+obj.Elements[j].Name);logger("RTTO: VARIANT: "+obj.Elements[j].VariantName)}}}return cryptoSubtle()}};function init(){window.addEventListener("load",(function(){if(window.sendRTTODataToGA&&utag_data.rtto_exp){window.sendRTTODataToGA(utag_data.rtto_exp)}else{setTimeout((function(){if(window.sendRTTODataToGA&&utag_data.rtto_exp){window.sendRTTODataToGA(utag_data.rtto_exp)}}),1e3)}}));setNonceAttribute();hasCampaign(exclude,"exclude");!isExcluded&&hasCampaign(whitelist,"include")}return{init:init,isDev:isDev,enable:enabled,validUDO:validUDO,mtTagPath:mtTagPath,packageHandler:packageHandler,nonce:nonce,hasGeneralNelson:hasGeneralNelson,validResponse:validResponse,utag_data:utag_data}}();if(TNL.enable&&TNL.validUDO&&!TNL.hasGeneralNelson){TNL.init()}